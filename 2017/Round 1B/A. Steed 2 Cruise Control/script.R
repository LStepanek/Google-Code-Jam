###############################################################################
###############################################################################
###############################################################################

## I am loading input data ----------------------------------------------------

my_input <- file.choose()
my_data <- readLines(my_input)


## ----------------------------------------------------------------------------

###############################################################################

## I am changing a working directory ------------------------------------------

setwd(
    gsub("(.*\\\\)(.*)", "\\1", my_input)
)


## ----------------------------------------------------------------------------

###############################################################################

## helper functions -----------------------------------------------------------

solveTheCase <- function(
    
    my_case
    
){
    
    # '''
    # Returns a solution for one case of the input data.
    # '''
    
    D <- as.integer(strsplit(my_case[1], split = " ")[[1]][1])
    N <- as.integer(strsplit(my_case[1], split = " ")[[1]][2])
    
    my_horse_distances <- as.integer(
        lapply(
            my_case[2:length(my_case)],
            function(x) strsplit(x, split = " ")[[1]][1]
        )
    )
    
    my_horse_speeds <- as.integer(
        lapply(
            my_case[2:length(my_case)],
            function(x) strsplit(x, split = " ")[[1]][2]
        )
    )
    
    return(
        D / max((D - my_horse_distances) / my_horse_speeds)
    )
    
}


## ----------------------------------------------------------------------------

###############################################################################

## core computations ----------------------------------------------------------

my_output <- NULL

i <- 1
j <- 2

while(j < length(my_data)){
    
    my_case <- my_data[
        j:(j + as.integer(strsplit(my_data[j], split = " ")[[1]][2]))
    ]
    
    my_output <- c(
        my_output,
        paste(
            "Case #",
            i,
            ": ",
            format(
                solveTheCase(my_case),
                nsmall = 10,
                scientific = FALSE
            ),
            sep = ""
        )
    )
    
    flush.console()
    print(
        paste(
            "Process is ",
            format(
                round(
                    i / as.integer(my_data[1]) * 100,
                    digits = 2
                ),
                nsmall = 2
            ),
            " % complete.",
            sep = ""            
        )
    )
        
    i <- i + 1
    j <- j + as.integer(strsplit(my_data[j], split = " ")[[1]][2]) + 1
    
}


## ----------------------------------------------------------------------------

###############################################################################

## I am giving an output ------------------------------------------------------

writeLines(
    my_output,
    con = gsub(
        ".in",
        "-out.in",
        gsub("(.*\\\\)(.*)", "\\2", my_input)
    )
)


## ----------------------------------------------------------------------------

###############################################################################
###############################################################################
###############################################################################





